<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madan Mohan Malaviya University of Technology, Gorakhpur (U.P.) India</title>
    <meta content="" name="description">
    <meta content="" name="keywords">


    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon">
    <link href="/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Bootstrap Link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">


    <!-- Template Main CSS File -->
    <link href="/main.css" rel="stylesheet">
    <!-- JQuerry -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>


    <!--Bootstrap JavaScript-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous">
        </script>

    <!-- Bootstrap Beta CSS, JS & JQuerry -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css"
        rel="stylesheet">


</head>

<body>
    <style>
        #admin-area {
            position: relative;
            padding: 6rem 0 0 0;
            /* height: 100vh; */
            /* width: 100%; */
        }

        #col-one button {
            width: 100%;
            padding: 0.5rem 0;
            margin: 1em 0;
        }

        #div-two {
            border-radius: 10px;
        }

        #col-two ul {
            list-style: none;
            color: white;
        }
    </style>
    <header id="header">
        <nav class="navbar navbar-expand-md navbar-light fixed-top bg-white ">
            <div class="container-fluid px-lg-5 ">
                <a id="head" class="navbar-brand" href="index.html"><img src="/img/favicon.png" alt="">M.M.M.U.T.</a>
                <li class="nav-link ">
                    <a href="/admin/logout">Log Out</a>
                </li>

            </div>
        </nav>
    </header>
    <section id="admin-area">
        <div class="container-xl ">
            <div class="row " style="height: 100%;  background: #1d2630; border-radius: 20px;">
                <div id="col-one" class="col-lg-2 col-md-3 col-4 pt-2">
                    <h3 class="text-center text-white ">Update Teacher's Details</h3>
                    <div style="height: 2px;background: rgb(255, 100, 100);"></div>
                    <div>
                        <div>
                            <a href="/admin/dashboard"><button class="btn btn-light ">Dashboard</button></a>
                        </div>
                        <div>
                            <a href="/admin/branch"><button class="btn btn-light ">Update Branch Details</button></a>
                        </div>
                        <div>
                            <a href="/admin/teachers"><button class="btn btn-light ">Update Teacher's
                                    Details</button></a>
                        </div>
                        <div>
                            <a href="/admin/students"><button class="btn btn-light ">Update Student's
                                    Details</button></a>
                        </div>
                        <div>
                            <a href="/admin/password"><button class="btn btn-light ">Change Password</button></a>
                        </div>
                    </div>
                </div>
                <div id="col-two" class="col-lg-10 col-md-9  col-8 p-2 ">
                    <div id="div-two" class="text-center bg-white justify-content-center">
                        <h3 class="">Administration</h3>
                    </div>
                    <div class="text-center pt-2">
                        <form action="../admin/teachers" method="get">
                            <select id="branch" name="branch">
                                <option value="" disabled selected>Select branch</option>
                                <% for(let i=0 ; i < branchList.length ; i++) {%>
                                    <option value="<%= branchList[i].name %>">
                                        <%= branchList[i].name %>
                                    </option>
                                    <% } %>
                            </select>
                            <button type="submit">Search</button>
                        </form>
                    </div>
                    <div id="addBox" class="row px-4 pt-2">
                        <form action="../admin/teachers-data" method="post" class=".needs-validation">
                            <div class="form-group col-md-6 mb-3 ">
                                <h3>Branch</h3>
                                <h3>
                                    <%= branchDetails.name %>
                                </h3>
                                <input type="hidden" name="hiddenBranch" id="hiddenBranch" value="" required>
                            </div>
                            <div class="form-group col-md-6 mb-3">
                                <label for="name">Name</label>
                                <input type="text" name="name" id="name" placeholder="Enter teacher's name"
                                    class="form-control" required>
                            </div>
                            <div class="form-group col-md-6 mb-3">
                                <label for="subject" style="display: block; width: 100%; ">Select Subjects</label>
                                <select class="selectpicker form-control" multiple aria-label="Default select example"
                                    data-live-search="true" id="subject" name="subject[]" required>
                                    <% for(let i=0 ; i < branchDetails.Subjects.length ; i++) {%>
                                        <option value="<%= branchDetails.Subjects[i] %>">
                                            <%= branchDetails.Subjects[i] %>
                                        </option>
                                        <% } %>
                                </select>
                            </div>
                            <div class="form-group col-md-6 mb-3">
                                <label for="loginId">Login ID</label>
                                <input type="text" name="loginId" id="loginId" placeholder="Enter login id"
                                    class="form-control" required>
                            </div>
                            <div class="form-group col-md-6 mb-3">
                                <label for="password">Password</label>
                                <input type="password" name="password" id="password" placeholder="Enter password"
                                    class="form-control" required>
                            </div>
                            <div class="col pb-2">
                                <button type="submit" class="btn btn-success">ADD</button>
                            </div>
                            <hr>
                        </form>

                    </div>
                    <div id="dataBox" class="row pt-2">
                        <div class="col px-4">
                            <table class="table table-bordered text-white" id="dataTable">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Subjects</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for (let i=0; i < theTeachersData.length; i++) { %>
                                        <tr>
                                            <td>
                                                <%= theTeachersData[i].name %>
                                            </td>
                                            <td>
                                                <ul>
                                                    <% for (let j of theTeachersData[i].subject) { %>
                                                        <li>
                                                            <%= j %>
                                                        </li>
                                                        <% } %>
                                                </ul>
                                            </td>
                                            <td>
                                                <form action="/admin/teachers/<%= theTeachersData[i]._id %>?_method=DELETE" method="post"><button class="btn btn-danger">Delete</button></form>
                                                <a href="<%= `/admin/teachers-edit/${theTeachersData[i]._id}` %>"><button
                                                        class="btn btn-warning">Edit</button></a>
                                            </td>
                                        </tr>
                                        <% } %>

                                </tbody>

                            </table>
                        </div>
                    </div>
                </div>
            </div>
    </section>
    <script>
        const branch = document.querySelector("#hiddenBranch");
        branch.value = '<%= branchDetails.name %>';

        //  JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }

                        form.classList.add('was-validated')
                    }, false)
                })
            // password checking 
            const newPassInput = document.getElementById('password');
            newPassInput.addEventListener('input', function () {
                const inputValue = newPassInput.value;
                // Define regular expressions to check for letters, numbers, and disallowed characters
                const letterPattern = /[a-zA-Z]/;
                const numberPattern = /\d/;
                const disallowedPattern = /[ !@#$%^&*()_+{}\[\]:;<>,.?~\\]/;

                // Check password criteria
                if (
                    inputValue.length >= 8 &&
                    inputValue.length <= 20 &&
                    letterPattern.test(inputValue) &&
                    numberPattern.test(inputValue) &&
                    !/\s/.test(inputValue) &&
                    !disallowedPattern.test(inputValue) &&
                    !containsEmoji(inputValue)
                ) {
                    newPassInput.setCustomValidity(''); // Reset custom validation message
                } else {
                    newPassInput.setCustomValidity('Password must be 8-20 characters long, contain letters and numbers, and must not contain spaces, special characters, or emojis.');
                }
            });

            // Function to check for emojis
            function containsEmoji(text) {
                const emojiPattern = /[\uD83C-\uDBFF\uDC00-\uDFFF\u2600-\u2B55\u23E9]/;
                return emojiPattern.test(text);
            }
            const emailInput = document.getElementById('loginId');
            emailInput.addEventListener('input', validateEmail);
            function validateEmail() {
                const emailValue = emailInput.value;
                const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;

                if (emailPattern.test(emailValue)) {
                    emailInput.setCustomValidity('');
                } else {
                    emailInput.setCustomValidity('Invalid email format');
                }
            }
        })()
    </script>