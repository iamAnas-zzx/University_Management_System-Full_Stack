<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madan Mohan Malaviya University of Technology, Gorakhpur (U.P.) India</title>
    <meta content="" name="description">
    <meta content="" name="keywords">


    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon">
    <link href="/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Bootstrap Link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">


    <!-- Template Main CSS File -->
    <link href="/main.css" rel="stylesheet">
    <!-- JQuerry -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>


    <!--Bootstrap JavaScript-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous">
        </script>


</head>

<body>
    <style>
        #admin-area {
            position: relative;
            padding: 6rem 0 0 0;
        }

        #col-one button {
            width: 100%;
            padding: 0.5rem 0;
            margin: 1em 0;
        }

        #div-two {
            border-radius: 10px;
        }

        ul {
            list-style: none;
            color: white;
        }

        #editBox {
            display: none;
        }

        @media(min-width:992px) {
            #addBox input {
                width: 50%;
            }
        }
    </style>
    <header id="header">

        <nav class="navbar navbar-expand-md navbar-light fixed-top bg-white ">
            <div class="container-fluid px-lg-5 ">
                <a id="head" class="navbar-brand" href="index.html"><img src="/img/favicon.png" alt="">M.M.M.U.T.</a>
                <li class="nav-link ">
                    <a href="/admin/logout">Log Out</a>
                </li>

            </div>
        </nav>
    </header>
    <section id="admin-area">
        <div class="container-xl ">
            <div class="row " style="height: 100%;  background: #1d2630; border-radius: 20px;">
                <div id="col-one" class="col-lg-2 col-md-3 col-4 pt-2">
                    <h3 class="text-center text-white ">Update Branch Details</h3>
                    <div style="height: 2px;background: rgb(255, 100, 100);"></div>
                    <div>
                        <div>
                            <a href="/admin/dashboard"><button class="btn btn-light ">Dashboard</button></a>
                        </div>
                        <div>
                            <a href="/admin/branch"><button class="btn btn-light ">Update Branch Details</button></a>
                        </div>
                        <div>
                            <a href="/admin/teachers"><button class="btn btn-light ">Update Teacher's
                                    Details</button></a>
                        </div>
                        <div>
                            <a href="/admin/students"><button class="btn btn-light ">Update Student's
                                    Details</button></a>
                        </div>
                        <div>
                            <a href="/admin/password"><button class="btn btn-light ">Change Password</button></a>
                        </div>
                    </div>
                </div>
                <div id="col-two" class="col-lg-10 col-md-9  col-8 p-2 ">
                    <div id="div-two" class="text-center bg-white justify-content-center">
                        <h3 class="">Administration</h3>
                    </div>
                    <div id="addBox" class="row px-4 pt-2 flex-column ">
                        <form action="../admin/branch" method="post" class=".needs-validation">
                            <div class="form-group col mb-3">
                                <label for="name">Branch Name</label>
                                <input type="text" name="name" id="name" placeholder="Enter branch name"
                                    class="form-control" required>
                            </div>
                            <div class="form-group col mb-3 ">
                                <label for="subjectName">Subjects</label>
                                <input type="text" id="subjectName" name="subjectName" placeholder="Enter subject"
                                    class="form-control" >
                                <button type="button" id="addItemButton">Add Subject</button>
                                <ul id="itemList">
                                    <!-- List items will be added here dynamically -->
                                </ul>
                            </div>
                            <input type="hidden" id="hiddenSubjects" name="hiddenSubjects" value="" required>

                            <div class="col pb-2">
                                <button type="submit" class="btn btn-success">ADD Branch</button>
                            </div>
                            <hr>
                        </form>
                    </div>
                    <% if(showEditBox) {%>
                        <div id="editBox" class="row px-4 pt-2">
                            <form action="/admin/branch/<%= branch._id%>?_method=PUT" method="post" class=".needs-validation">
                                <div class="form-group col-md-6 mb-3 ">
                                    <h3>Branch</h3>
                                    <h3>
                                        <%= branch.name %>
                                    </h3>
                                </div>
                                <div class="form-group col-md-6 mb-3">
                                    <label for="name">Edit Name</label>
                                    <input type="text" name="name" placeholder="" class="form-control"
                                        value="<%= branch.name %>" required >
                                </div>
                                <div class="form-group col-md-6 mb-3 ">
                                    <label for="Subjects">Subjects</label>
                                    <ul id="subjectList" class="list-group">
                                        <% subjectsList.forEach((subject, index)=> { %>
                                            <!-- Subject items will be added here dynamically -->
                                            <li>
                                                <input type="text" id="" name="subjectName" placeholder=""
                                                    class="form-control my-1" value="<%= subject %>"  required>

                                            </li>
                                            <% }); %>
                                    </ul>
                                </div>

                                <div class="col pb-2">
                                    <button class="btn btn-success">Update</button>
                                </div>
                                <hr>
                            </form>
                        </div>
                        <% } %>
                            <div class="row pt-2">
                                <div class="col px-4">
                                    <table class="table table-bordered text-white" id="dataTable">
                                        <thead>
                                            <tr>
                                                <th>Branch</th>
                                                <th>Subjects</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% for(let i=0; i < branchList.length; i++) { %>
                                                <tr>
                                                    <td>
                                                        <%= branchList[i].name %>
                                                    </td>
                                                    <td>
                                                        <ul>
                                                            <% for(let j of branchList[i].Subjects){ %>
                                                                <li>
                                                                    <%= j %>
                                                                </li>
                                                                <% } %>
                                                        </ul>
                                                    </td>
                                                    <td>
                                                        <form action="/admin/branch/<%=  branchList[i]._id %>?_method=DELETE" method="post" ><button type="submit" class="btn btn-danger">Delete</button></form>
                                                        <a href="<%= `/admin/branch/${branchList[i]._id}` %>"><button
                                                                class="btn btn-warning">Edit</button></a>
                                                    </td>
                                                </tr>
                                                <%}%>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                </div>
            </div>
    </section>
    <script>
        function addItem() {
            const newItemInput = document.getElementById("subjectName");
            const newItemText = newItemInput.value.trim();
            //const itenList = document.getElementById("itemList");



            if (newItemText !== "") {
                const itemList = document.getElementById("itemList");
                const newItemElement = document.createElement("li");
                newItemElement.textContent = newItemText;

                // Create a delete button for the item
                const deleteButton = document.createElement("button");
                deleteButton.textContent = "Delete";
                deleteButton.addEventListener("click", function () {
                    itemList.removeChild(newItemElement);
                    updateHiddenSubjects();
                });

                newItemElement.appendChild(deleteButton);
                itemList.appendChild(newItemElement);
                newItemInput.value = ""; // Clear the input field
                updateHiddenSubjects();
            }
        }
        function updateHiddenSubjects() {
            const itemList = document.getElementById("itemList");
            const subjectsArray = Array.from(itemList.children).map(item => item.textContent.split("Delete")[0]);

            const hiddenSubjectsInput = document.getElementById("hiddenSubjects");
            hiddenSubjectsInput.value = subjectsArray.join(",");
        }

        // Attach the addItem function to the button click event
        const addItemButton = document.getElementById('addItemButton');
        addItemButton.addEventListener('click', addItem);

        // JavaScript for disabling form submissions if there are invalid fields
        (function () {
                    'use strict'

                    // Fetch all the forms we want to apply custom Bootstrap validation styles to
                    var forms = document.querySelectorAll('.needs-validation')

                    // Loop over them and prevent submission
                    Array.prototype.slice.call(forms)
                        .forEach(function (form) {
                            form.addEventListener('submit', function (event) {
                                if (!form.checkValidity()) {
                                    event.preventDefault()
                                    event.stopPropagation()
                                }

                                form.classList.add('was-validated')
                            }, false)
                        })
                })()

    </script>


    <% if (showEditBox) { %>
        <script>
            // JavaScript code to execute when showEditBox is true
            const addData = document.querySelector('#addBox');
            const editData = document.querySelector("#editBox");
            addData.style.display = 'none';
            editData.style.display = 'block';
        </script>
        <% } %>
